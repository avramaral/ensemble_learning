# Line plot over the horizons
df_wis_horizon_truth <- compute_wis_horizon_truth(models = models, horizon = horizon, wis_summ = wis_summ)
wis_line_horizon <- plot_wis_line_horizon(df_wis_horizon = df_wis_horizon_truth, models = models, colors = colors)
tmp_ttl <- ""
p_total <- wis_bar + wis_line_horizon + coverage_bar + plot_annotation(title = tmp_ttl, theme = theme(plot.margin = margin(), text = element_text(size = 14, family = "LM Roman 10")))
if (FALSE) { # Plot all strata
p_all    <- readRDS("PLOTS/ENSEMBLE/WIS_all_ensemble.RDS")    &  plot_annotation(title = "National level") & theme(plot.title = element_text(hjust = 0.5, size = 18))
p_ages   <- readRDS("PLOTS/ENSEMBLE/STRATIFIED/WIS_ages_ensemble.RDS")   &  plot_annotation(title = "Age groups")     & theme(plot.title = element_text(hjust = 0.5, size = 18))
p_states <- readRDS("PLOTS/ENSEMBLE/STRATIFIED/WIS_states_ensemble.RDS") &  plot_annotation(title = "States")         & theme(plot.title = element_text(hjust = 0.5, size = 18))
t_all    <- grid::textGrob("National level", gp = gpar(fontfamily = "LM Roman 10", cex = 1.5))
t_ages   <- grid::textGrob("Age groups",     gp = gpar(fontfamily = "LM Roman 10", cex = 1.5))
t_states <- grid::textGrob("States",         gp = gpar(fontfamily = "LM Roman 10", cex = 1.5))
c_all    <- (wrap_elements(panel = t_all)    / p_all)    + plot_layout(heights = c(1, 10))
c_ages   <- (wrap_elements(panel = t_ages)   / p_ages)   + plot_layout(heights = c(1, 10))
c_states <- (wrap_elements(panel = t_states) / p_states) + plot_layout(heights = c(1, 10))
p_total2 <- wrap_elements(c_states + plot_annotation(theme = theme(plot.margin = margin(-15, 0, -5, 0)))) /
wrap_elements(c_ages   + plot_annotation(theme = theme(plot.margin = margin(-15, 0, -5, 0))))
p_total3 <- wrap_elements(c_all    + plot_annotation(theme = theme(plot.margin = margin(-15, 0, -5, 0)))) /
wrap_elements(c_states + plot_annotation(theme = theme(plot.margin = margin(-15, 0, -5, 0)))) /
wrap_elements(c_ages   + plot_annotation(theme = theme(plot.margin = margin(-15, 0, -5, 0)))) + plot_layout(heights = c(1.5, 1, 1))
ggsave(filename = "PLOTS/ENSEMBLE/WIS_ensemble_2.jpeg", plot = p_total2, width = 4700, height = 3066, units = c("px"), dpi = 300, bg = "white")
ggsave(filename = "PLOTS/ENSEMBLE/WIS_ensemble_3.jpeg", plot = p_total3, width = 4900, height = 5366, units = c("px"), dpi = 300, bg = "white")
}
rr <- range(data$forecast_date)
skip_first_days_1 <- uncertain_size + 1
skip_first_days_2 <- 1
quant <- TRUE
horiz <- TRUE
w_hat_file <- paste("RESULTS/w_hat_size_", training_size, "_state_", state, "_age_", age, "_quant_", as.character(quant), "_horiz_", as.character(horiz), ".RDS", sep = "")
if (file.exists(w_hat_file)) {
w_hat <- readRDS(file = w_hat_file)
w_hat_DISW_1 <- w_hat$w_hat_DISW_1
w_hat_DISW_2 <- w_hat$w_hat_DISW_2
w_hat_DISW_3 <- w_hat$w_hat_DISW_3
w_hat_DISW_4 <- w_hat$w_hat_DISW_4
w_hat_AISW_1 <- w_hat$w_hat_AISW_1
w_hat_AISW_2 <- w_hat$w_hat_AISW_2
w_hat_AISW_3 <- w_hat$w_hat_AISW_3
w_hat_AISW_4 <- w_hat$w_hat_AISW_4
} else {
w_hat_DISW_1 <- weights_tibble(ensemble = DISW_1_ens, r = rr, models = models_orig, horizon = horizon, skip_first_days = skip_first_days_1, probs = probs, ens_model = "DISW", horiz = horiz)
w_hat_DISW_2 <- weights_tibble(ensemble = DISW_2_ens, r = rr, models = models_orig, horizon = horizon, skip_first_days = skip_first_days_2, probs = probs, ens_model = "DISW", horiz = horiz)
w_hat_DISW_3 <- weights_tibble(ensemble = DISW_3_ens, r = rr, models = models_orig, horizon = horizon, skip_first_days = skip_first_days_2, probs = probs, ens_model = "DISW", horiz = horiz)
w_hat_DISW_4 <- weights_tibble(ensemble = DISW_4_ens, r = rr, models = models_orig, horizon = horizon, skip_first_days = skip_first_days_2, probs = probs, ens_model = "DISW", horiz = horiz)
w_hat_AISW_1 <- weights_tibble(ensemble = AISW_1_ens, r = rr, models = models_orig, horizon = horizon, skip_first_days = skip_first_days_1, probs = probs, ens_model = "AISW", horiz = horiz, excep = TRUE)
w_hat_AISW_2 <- weights_tibble(ensemble = AISW_2_ens, r = rr, models = models_orig, horizon = horizon, skip_first_days = skip_first_days_2, probs = probs, ens_model = "AISW", horiz = horiz, excep = TRUE)
w_hat_AISW_3 <- weights_tibble(ensemble = AISW_3_ens, r = rr, models = models_orig, horizon = horizon, skip_first_days = skip_first_days_2, probs = probs, ens_model = "AISW", horiz = horiz, excep = TRUE)
w_hat_AISW_4 <- weights_tibble(ensemble = AISW_4_ens, r = rr, models = models_orig, horizon = horizon, skip_first_days = skip_first_days_2, probs = probs, ens_model = "AISW", horiz = horiz)
w_hat <- list(w_hat_DISW_1 = w_hat_DISW_1, w_hat_DISW_2 = w_hat_DISW_2, w_hat_DISW_3 = w_hat_DISW_3, w_hat_DISW_4 = w_hat_DISW_4, w_hat_AISW_1 = w_hat_AISW_1, w_hat_AISW_2 = w_hat_AISW_2, w_hat_AISW_3 = w_hat_AISW_3, w_hat_AISW_4 = w_hat_AISW_4)
saveRDS(object = w_hat, file = w_hat_file)
}
aggregate_total <- FALSE
indep_quant <- TRUE
formatted_w_hat_file <- paste("RESULTS/w_hat_per_horizon_size_", training_size, "_state_", state, "_age_", age, "_quant_", as.character(quant), "_horiz_", as.character(horiz), ".RDS", sep = "")
if (file.exists(formatted_w_hat_file) & (!(aggregate_total | indep_quant))) { # Read files `per horizon` (as this takes longer to run)
formatted_w_hat <- readRDS(file = formatted_w_hat_file)
formatted_w_hat_DISW_1 <- formatted_w_hat$formatted_w_hat_DISW_1
formatted_w_hat_DISW_2 <- formatted_w_hat$formatted_w_hat_DISW_2
formatted_w_hat_DISW_3 <- formatted_w_hat$formatted_w_hat_DISW_3
formatted_w_hat_DISW_4 <- formatted_w_hat$formatted_w_hat_DISW_4
formatted_w_hat_AISW_1 <- formatted_w_hat$formatted_w_hat_AISW_1
formatted_w_hat_AISW_2 <- formatted_w_hat$formatted_w_hat_AISW_2
formatted_w_hat_AISW_3 <- formatted_w_hat$formatted_w_hat_AISW_3
formatted_w_hat_AISW_4 <- formatted_w_hat$formatted_w_hat_AISW_4
} else {
print("DISW_1")
formatted_w_hat_DISW_1 <- format_w_hat(w_hat = w_hat_DISW_1, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("DISW_2")
formatted_w_hat_DISW_2 <- format_w_hat(w_hat = w_hat_DISW_2, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("DISW_3")
formatted_w_hat_DISW_3 <- format_w_hat(w_hat = w_hat_DISW_3, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("DISW_4")
formatted_w_hat_DISW_4 <- format_w_hat(w_hat = w_hat_DISW_4, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("AISW_1")
formatted_w_hat_AISW_1 <- format_w_hat(w_hat = w_hat_AISW_1, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("AISW_2")
formatted_w_hat_AISW_2 <- format_w_hat(w_hat = w_hat_AISW_2, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("AISW_3")
formatted_w_hat_AISW_3 <- format_w_hat(w_hat = w_hat_AISW_3, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("AISW_4")
formatted_w_hat_AISW_4 <- format_w_hat(w_hat = w_hat_AISW_4, aggregate_total = aggregate_total, indep_quant = indep_quant)
if (!(aggregate_total | indep_quant)) {
saveRDS(object = list(formatted_w_hat_DISW_1 = formatted_w_hat_DISW_1,
formatted_w_hat_DISW_2 = formatted_w_hat_DISW_2,
formatted_w_hat_DISW_3 = formatted_w_hat_DISW_3,
formatted_w_hat_DISW_4 = formatted_w_hat_DISW_4,
formatted_w_hat_AISW_1 = formatted_w_hat_AISW_1,
formatted_w_hat_AISW_2 = formatted_w_hat_AISW_2,
formatted_w_hat_AISW_3 = formatted_w_hat_AISW_3,
formatted_w_hat_AISW_4 = formatted_w_hat_AISW_4), file = formatted_w_hat_file)
}
}
v2 <- TRUE
# Plotting
extra_skip <- 30
plot_D1 <- plotting_summarized_weights(w_hat = formatted_w_hat_DISW_1$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip)
plot_D1 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_DISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, sub_tt = "")
plot_D1 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_DISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, all_same = TRUE)
plot_D1 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_DISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, sub_tt = "")
plot_D1
plot_A1
plot_A1 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_AISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25, sub_tt = "")
plotting_quantile_weights_v2 <- function (w_hat, r, models, colors, uncertain_size = 40, extra_skip = 0, y_max = NULL, sub_tt = "", ...) {
names(colors) <- models
alphas <- c(1, 2)
w_hat <- w_hat |> add_column(aa = factor(ifelse(w_hat$forecast_date <= (r[1] + 40), alphas[1], alphas[2])))
if (length(unique(w_hat$aa)) == 1) { af <- 1 } else { af <- c(0.25, 1) }
w_hat$quant <- factor(w_hat$quant)
pp <- ggplot(w_hat, aes(fill = as.factor(model), x = forecast_date)) +
facet_wrap("quant", scales = "fixed", ncol = 3) +
geom_bar(aes(y = value, alpha = aa), position = "stack", stat = "identity") + # c(fill, stack)
geom_vline(xintercept = as.numeric(r[1] + (uncertain_size + 1)) - 0.5, linetype = "dashed") +
geom_vline(xintercept = as.numeric(r[1] + (uncertain_size + 1)  + extra_skip) - 0.5, linetype = "dashed") +
{ if (!is.null(y_max)) geom_vline(yintercept = 1, linetype = "dashed")  } +
scale_fill_manual("Models ", values = colors) +
scale_alpha_manual(values = af, guide = "none") +
scale_x_date(limit = c((r[1] + 1), max(w_hat$forecast_date) + 1)) +
labs(x = "", y = paste("Weights", sub_tt, sep = "")) +
theme_bw() +
theme(plot.title = element_text(size = 16, hjust = 0.5, face = "bold"),
legend.position = "bottom",
legend.title = element_text(size = 16),
legend.text = element_text(size = 16),
strip.text = element_text(size = 16, margin = margin(b = 2, t = 2)),
axis.title.y = element_text(size = 16),
axis.text = element_text(size = 16),
axis.ticks = element_line(colour = "black", linewidth = 0.25),
panel.grid.major = element_line(linewidth = 0.15),
panel.grid.minor = element_line(linewidth = 0.1),
plot.margin = unit(c(1, 1.5, 0, 1.5), "pt"),
legend.margin = margin(0, 0.5, 0, 5),
legend.box.spacing = unit(0, "pt"),
legend.background = element_rect(fill = "transparent"),
text = element_text(size = 16, family = "LM Roman 10")) +
{ if (!is.null(y_max)) scale_y_continuous(breaks = seq(0, y_max, length.out = 6), limits = c(0, y_max)) } +
{ if ( is.null(y_max)) scale_y_continuous() } +
guides(fill = guide_legend(nrow = 2))
pp
}
plot_A1 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_AISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25, sub_tt = "")
plot_A1 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_AISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25, sub_tt = "")
plotting_quantile_weights_v2 <- function (w_hat, r, models, colors, uncertain_size = 40, extra_skip = 0, y_max = NULL, sub_tt = "", ...) {
names(colors) <- models
alphas <- c(1, 2)
w_hat <- w_hat |> add_column(aa = factor(ifelse(w_hat$forecast_date <= (r[1] + 40), alphas[1], alphas[2])))
if (length(unique(w_hat$aa)) == 1) { af <- 1 } else { af <- c(0.25, 1) }
w_hat$quant <- factor(w_hat$quant)
pp <- ggplot(w_hat, aes(fill = as.factor(model), x = forecast_date)) +
facet_wrap("quant", scales = "fixed", ncol = 3) +
geom_bar(aes(y = value, alpha = aa), position = "stack", stat = "identity") + # c(fill, stack)
geom_vline(xintercept = as.numeric(r[1] + (uncertain_size + 1)) - 0.5, linetype = "dashed") +
geom_vline(xintercept = as.numeric(r[1] + (uncertain_size + 1)  + extra_skip) - 0.5, linetype = "dashed") +
{ if (!is.null(y_max)) geom_hline(yintercept = 1, linetype = "dashed")  } +
scale_fill_manual("Models ", values = colors) +
scale_alpha_manual(values = af, guide = "none") +
scale_x_date(limit = c((r[1] + 1), max(w_hat$forecast_date) + 1)) +
labs(x = "", y = paste("Weights", sub_tt, sep = "")) +
theme_bw() +
theme(plot.title = element_text(size = 16, hjust = 0.5, face = "bold"),
legend.position = "bottom",
legend.title = element_text(size = 16),
legend.text = element_text(size = 16),
strip.text = element_text(size = 16, margin = margin(b = 2, t = 2)),
axis.title.y = element_text(size = 16),
axis.text = element_text(size = 16),
axis.ticks = element_line(colour = "black", linewidth = 0.25),
panel.grid.major = element_line(linewidth = 0.15),
panel.grid.minor = element_line(linewidth = 0.1),
plot.margin = unit(c(1, 1.5, 0, 1.5), "pt"),
legend.margin = margin(0, 0.5, 0, 5),
legend.box.spacing = unit(0, "pt"),
legend.background = element_rect(fill = "transparent"),
text = element_text(size = 16, family = "LM Roman 10")) +
{ if (!is.null(y_max)) scale_y_continuous(breaks = seq(0, y_max, length.out = 6), limits = c(0, y_max)) } +
{ if ( is.null(y_max)) scale_y_continuous() } +
guides(fill = guide_legend(nrow = 2))
pp
}
plot_A1 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_AISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25, sub_tt = "")
plot_A1
v2 <- TRUE
# Plotting
extra_skip <- 30
if (aggregate_total) { # Aggregated
plot_D1 <- plotting_summarized_weights(w_hat = formatted_w_hat_DISW_1$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip)
plot_D2 <- plotting_summarized_weights(w_hat = formatted_w_hat_DISW_2$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip)
plot_D3 <- plotting_summarized_weights(w_hat = formatted_w_hat_DISW_3$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip)
plot_D4 <- plotting_summarized_weights(w_hat = formatted_w_hat_DISW_4$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip)
plot_A1 <- plotting_summarized_weights(w_hat = formatted_w_hat_AISW_1$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25)
plot_A2 <- plotting_summarized_weights(w_hat = formatted_w_hat_AISW_2$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25)
plot_A3 <- plotting_summarized_weights(w_hat = formatted_w_hat_AISW_3$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25)
plot_A4 <- plotting_summarized_weights(w_hat = formatted_w_hat_AISW_4$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25)
} else {
if (indep_quant) { # Per quantile
plot_D1 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_DISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, sub_tt = "")
plot_D2 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_DISW_2$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, sub_tt = "")
plot_D3 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_DISW_3$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, sub_tt = "")
plot_D4 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_DISW_4$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, sub_tt = " (Averaged over horizons)")
plot_A1 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_AISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25, sub_tt = "")
plot_A2 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_AISW_2$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25, sub_tt = "")
plot_A3 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_AISW_3$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25, sub_tt = "")
plot_A4 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_AISW_4$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25, sub_tt = " (Averaged over horizons)")
} else { # Per horizon
plot_D1 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_DISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, all_same = TRUE)
plot_D2 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_DISW_2$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, all_same = TRUE)
plot_D3 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_DISW_3$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, all_same = TRUE)
plot_D4 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_DISW_4$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, all_same = FALSE)
plot_A1 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_AISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, y_max = 1.25, all_same = TRUE)
plot_A2 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_AISW_2$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, y_max = 1.25, all_same = TRUE)
plot_A3 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_AISW_3$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, y_max = 1.25, all_same = TRUE)
plot_A4 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_AISW_4$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, y_max = 1.25, all_same = FALSE)
}
}
dim_f <- function (all_same, ...) {
if (v2 == TRUE) { wi <- 4600; he <- 1375 } else { wi <- 3500; he <- 2500 }
if (!aggregate_total & !indep_quant) {
if (v2 == TRUE) {
if (all_same) {
wi <- 2080 # 1533
he <- 1250
} else {
wi <- 4600; he <- 3500
}
} else { stop("To be defined.") }
}
c(wi, he)
}
dim_same <- dim_f(all_same = TRUE )
dim_vary <- dim_f(all_same = FALSE)
ggsave(filename = paste("PLOTS/weights_A1.jpeg", sep = ""), plot = plot_A1, width = dim_same[1], height = dim_same[2], units = c("px"), dpi = 300, bg = "white")
ggsave(filename = paste("PLOTS/weights_A2.jpeg", sep = ""), plot = plot_A2, width = dim_same[1], height = dim_same[2], units = c("px"), dpi = 300, bg = "white")
ggsave(filename = paste("PLOTS/weights_A3.jpeg", sep = ""), plot = plot_A3, width = dim_same[1], height = dim_same[2], units = c("px"), dpi = 300, bg = "white")
ggsave(filename = paste("PLOTS/weights_A4.jpeg", sep = ""), plot = plot_A4, width = dim_vary[1], height = dim_vary[2], units = c("px"), dpi = 300, bg = "white")
aggregate_total <- FALSE
indep_quant <- FALSE
formatted_w_hat_file <- paste("RESULTS/w_hat_per_horizon_size_", training_size, "_state_", state, "_age_", age, "_quant_", as.character(quant), "_horiz_", as.character(horiz), ".RDS", sep = "")
if (file.exists(formatted_w_hat_file) & (!(aggregate_total | indep_quant))) { # Read files `per horizon` (as this takes longer to run)
formatted_w_hat <- readRDS(file = formatted_w_hat_file)
formatted_w_hat_DISW_1 <- formatted_w_hat$formatted_w_hat_DISW_1
formatted_w_hat_DISW_2 <- formatted_w_hat$formatted_w_hat_DISW_2
formatted_w_hat_DISW_3 <- formatted_w_hat$formatted_w_hat_DISW_3
formatted_w_hat_DISW_4 <- formatted_w_hat$formatted_w_hat_DISW_4
formatted_w_hat_AISW_1 <- formatted_w_hat$formatted_w_hat_AISW_1
formatted_w_hat_AISW_2 <- formatted_w_hat$formatted_w_hat_AISW_2
formatted_w_hat_AISW_3 <- formatted_w_hat$formatted_w_hat_AISW_3
formatted_w_hat_AISW_4 <- formatted_w_hat$formatted_w_hat_AISW_4
} else {
print("DISW_1")
formatted_w_hat_DISW_1 <- format_w_hat(w_hat = w_hat_DISW_1, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("DISW_2")
formatted_w_hat_DISW_2 <- format_w_hat(w_hat = w_hat_DISW_2, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("DISW_3")
formatted_w_hat_DISW_3 <- format_w_hat(w_hat = w_hat_DISW_3, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("DISW_4")
formatted_w_hat_DISW_4 <- format_w_hat(w_hat = w_hat_DISW_4, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("AISW_1")
formatted_w_hat_AISW_1 <- format_w_hat(w_hat = w_hat_AISW_1, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("AISW_2")
formatted_w_hat_AISW_2 <- format_w_hat(w_hat = w_hat_AISW_2, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("AISW_3")
formatted_w_hat_AISW_3 <- format_w_hat(w_hat = w_hat_AISW_3, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("AISW_4")
formatted_w_hat_AISW_4 <- format_w_hat(w_hat = w_hat_AISW_4, aggregate_total = aggregate_total, indep_quant = indep_quant)
if (!(aggregate_total | indep_quant)) {
saveRDS(object = list(formatted_w_hat_DISW_1 = formatted_w_hat_DISW_1,
formatted_w_hat_DISW_2 = formatted_w_hat_DISW_2,
formatted_w_hat_DISW_3 = formatted_w_hat_DISW_3,
formatted_w_hat_DISW_4 = formatted_w_hat_DISW_4,
formatted_w_hat_AISW_1 = formatted_w_hat_AISW_1,
formatted_w_hat_AISW_2 = formatted_w_hat_AISW_2,
formatted_w_hat_AISW_3 = formatted_w_hat_AISW_3,
formatted_w_hat_AISW_4 = formatted_w_hat_AISW_4), file = formatted_w_hat_file)
}
}
v2 <- TRUE
# Plotting
extra_skip <- 30
plot_D1 <- plotting_summarized_weights(w_hat = formatted_w_hat_DISW_1$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip)
plot_D1 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_DISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, all_same = TRUE)
plot_A1 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_AISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, y_max = 1.25, all_same = TRUE)
plot_A1
plot_D1
plotting_horizon_weights_v2 <- function (w_hat, r, models, colors, uncertain_size = 40, hhs = c(-28, -24, -20, -16, -12, -8, -4, 0), big_title = "", extra_skip = 0, y_max = NULL, all_same = FALSE, ...) {
names(colors) <- models
alphas <- c(1, 2)
w_hat <- w_hat |> add_column(aa = factor(ifelse(w_hat$forecast_date <= (r[1] + 40), alphas[1], alphas[2])))
if (length(unique(w_hat$aa)) == 1) { af <- 1 } else { af <- c(0.25, 1) }
w_hat <- w_hat |> filter(horizon %in% hhs)
w_hat$horizon <- factor(x = w_hat$horizon, levels = hhs)
if (all_same) {
w_hat <- w_hat[w_hat$horizon == hhs[1],]
leg_pos <- "right"
} else {
leg_pos <- "bottom"
}
pp <- ggplot(w_hat, aes(fill = as.factor(model), x = forecast_date)) +
{ if (!all_same) facet_wrap("horizon", scales = "fixed", ncol = 3) } +
geom_bar(aes(y = value, alpha = aa), position = "stack", stat = "identity") +
geom_vline(xintercept = as.numeric(r[1] + (uncertain_size + 1)) - 0.5, linetype = "dashed") +
geom_vline(xintercept = as.numeric(r[1] + (uncertain_size + 1)  + extra_skip) - 0.5, linetype = "dashed") +
{ if (!is.null(y_max)) geom_hline(yintercept = 1, linetype = "dashed") } +
scale_fill_manual("Models", values = colors) +
scale_alpha_manual(values = af, guide = "none") +
scale_x_date(limit = c((r[1] + 1), max(w_hat$forecast_date) + 1)) +
labs(x = "", y = "Weights (Averaged over quantiles)", title = big_title) +
theme_bw() +
theme(plot.title = element_text(size = 16, hjust = 0.5, face = "bold"),
legend.position = leg_pos,
legend.title = element_text(size = 16),
legend.text = element_text(size = 16),
strip.text = element_text(size = 16, margin = margin(b = 2, t = 2)),
axis.title.y = element_text(size = 16),
axis.text = element_text(size = 16),
axis.ticks = element_line(colour = "black", linewidth = 0.25),
panel.grid.major = element_line(linewidth = 0.15),
panel.grid.minor = element_line(linewidth = 0.1),
plot.margin = unit(c(1, 1.5, 0, 1.5), "pt"),
legend.margin = margin(0, 0, 0, 5),
legend.box.spacing = unit(0, "pt"),
legend.background = element_rect(fill = "transparent"),
text = element_text(size = 16, family = "LM Roman 10")) +
{ if (!is.null(y_max)) scale_y_continuous(breaks = seq(0, y_max, length.out = 6), limits = c(0, y_max)) } +
{ if ( is.null(y_max)) scale_y_continuous() }
pp
}
plot_A1 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_AISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, y_max = 1.25, all_same = TRUE)
plot_A1
plot_A1 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_AISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, y_max = 1.25, all_same = TRUE)
plot_A1
v2 <- TRUE
# Plotting
extra_skip <- 30
if (aggregate_total) { # Aggregated
plot_D1 <- plotting_summarized_weights(w_hat = formatted_w_hat_DISW_1$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip)
plot_D2 <- plotting_summarized_weights(w_hat = formatted_w_hat_DISW_2$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip)
plot_D3 <- plotting_summarized_weights(w_hat = formatted_w_hat_DISW_3$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip)
plot_D4 <- plotting_summarized_weights(w_hat = formatted_w_hat_DISW_4$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip)
plot_A1 <- plotting_summarized_weights(w_hat = formatted_w_hat_AISW_1$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25)
plot_A2 <- plotting_summarized_weights(w_hat = formatted_w_hat_AISW_2$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25)
plot_A3 <- plotting_summarized_weights(w_hat = formatted_w_hat_AISW_3$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25)
plot_A4 <- plotting_summarized_weights(w_hat = formatted_w_hat_AISW_4$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25)
} else {
if (indep_quant) { # Per quantile
plot_D1 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_DISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, sub_tt = "")
plot_D2 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_DISW_2$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, sub_tt = "")
plot_D3 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_DISW_3$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, sub_tt = "")
plot_D4 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_DISW_4$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, sub_tt = " (Averaged over horizons)")
plot_A1 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_AISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25, sub_tt = "")
plot_A2 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_AISW_2$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25, sub_tt = "")
plot_A3 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_AISW_3$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25, sub_tt = "")
plot_A4 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_AISW_4$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25, sub_tt = " (Averaged over horizons)")
} else { # Per horizon
plot_D1 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_DISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, all_same = TRUE)
plot_D2 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_DISW_2$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, all_same = TRUE)
plot_D3 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_DISW_3$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, all_same = TRUE)
plot_D4 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_DISW_4$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, all_same = FALSE)
plot_A1 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_AISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, y_max = 1.25, all_same = TRUE)
plot_A2 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_AISW_2$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, y_max = 1.25, all_same = TRUE)
plot_A3 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_AISW_3$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, y_max = 1.25, all_same = TRUE)
plot_A4 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_AISW_4$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, y_max = 1.25, all_same = FALSE)
}
}
dim_f <- function (all_same, ...) {
if (v2 == TRUE) { wi <- 4600; he <- 1375 } else { wi <- 3500; he <- 2500 }
if (!aggregate_total & !indep_quant) {
if (v2 == TRUE) {
if (all_same) {
wi <- 2080 # 1533
he <- 1250
} else {
wi <- 4600; he <- 3500
}
} else { stop("To be defined.") }
}
c(wi, he)
}
dim_same <- dim_f(all_same = TRUE )
dim_vary <- dim_f(all_same = FALSE)
ggsave(filename = paste("PLOTS/weights_D1.jpeg", sep = ""), plot = plot_D1, width = dim_same[1], height = dim_same[2], units = c("px"), dpi = 300, bg = "white")
ggsave(filename = paste("PLOTS/weights_D2.jpeg", sep = ""), plot = plot_D2, width = dim_same[1], height = dim_same[2], units = c("px"), dpi = 300, bg = "white")
ggsave(filename = paste("PLOTS/weights_D3.jpeg", sep = ""), plot = plot_D3, width = dim_same[1], height = dim_same[2], units = c("px"), dpi = 300, bg = "white")
ggsave(filename = paste("PLOTS/weights_D4.jpeg", sep = ""), plot = plot_D4, width = dim_vary[1], height = dim_vary[2], units = c("px"), dpi = 300, bg = "white")
ggsave(filename = paste("PLOTS/weights_A1.jpeg", sep = ""), plot = plot_A1, width = dim_same[1], height = dim_same[2], units = c("px"), dpi = 300, bg = "white")
ggsave(filename = paste("PLOTS/weights_A2.jpeg", sep = ""), plot = plot_A2, width = dim_same[1], height = dim_same[2], units = c("px"), dpi = 300, bg = "white")
ggsave(filename = paste("PLOTS/weights_A3.jpeg", sep = ""), plot = plot_A3, width = dim_same[1], height = dim_same[2], units = c("px"), dpi = 300, bg = "white")
ggsave(filename = paste("PLOTS/weights_A4.jpeg", sep = ""), plot = plot_A4, width = dim_vary[1], height = dim_vary[2], units = c("px"), dpi = 300, bg = "white")
aggregate_total <- TRUE
indep_quant <- FALSE
formatted_w_hat_file <- paste("RESULTS/w_hat_per_horizon_size_", training_size, "_state_", state, "_age_", age, "_quant_", as.character(quant), "_horiz_", as.character(horiz), ".RDS", sep = "")
if (file.exists(formatted_w_hat_file) & (!(aggregate_total | indep_quant))) { # Read files `per horizon` (as this takes longer to run)
formatted_w_hat <- readRDS(file = formatted_w_hat_file)
formatted_w_hat_DISW_1 <- formatted_w_hat$formatted_w_hat_DISW_1
formatted_w_hat_DISW_2 <- formatted_w_hat$formatted_w_hat_DISW_2
formatted_w_hat_DISW_3 <- formatted_w_hat$formatted_w_hat_DISW_3
formatted_w_hat_DISW_4 <- formatted_w_hat$formatted_w_hat_DISW_4
formatted_w_hat_AISW_1 <- formatted_w_hat$formatted_w_hat_AISW_1
formatted_w_hat_AISW_2 <- formatted_w_hat$formatted_w_hat_AISW_2
formatted_w_hat_AISW_3 <- formatted_w_hat$formatted_w_hat_AISW_3
formatted_w_hat_AISW_4 <- formatted_w_hat$formatted_w_hat_AISW_4
} else {
print("DISW_1")
formatted_w_hat_DISW_1 <- format_w_hat(w_hat = w_hat_DISW_1, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("DISW_2")
formatted_w_hat_DISW_2 <- format_w_hat(w_hat = w_hat_DISW_2, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("DISW_3")
formatted_w_hat_DISW_3 <- format_w_hat(w_hat = w_hat_DISW_3, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("DISW_4")
formatted_w_hat_DISW_4 <- format_w_hat(w_hat = w_hat_DISW_4, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("AISW_1")
formatted_w_hat_AISW_1 <- format_w_hat(w_hat = w_hat_AISW_1, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("AISW_2")
formatted_w_hat_AISW_2 <- format_w_hat(w_hat = w_hat_AISW_2, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("AISW_3")
formatted_w_hat_AISW_3 <- format_w_hat(w_hat = w_hat_AISW_3, aggregate_total = aggregate_total, indep_quant = indep_quant)
print("AISW_4")
formatted_w_hat_AISW_4 <- format_w_hat(w_hat = w_hat_AISW_4, aggregate_total = aggregate_total, indep_quant = indep_quant)
if (!(aggregate_total | indep_quant)) {
saveRDS(object = list(formatted_w_hat_DISW_1 = formatted_w_hat_DISW_1,
formatted_w_hat_DISW_2 = formatted_w_hat_DISW_2,
formatted_w_hat_DISW_3 = formatted_w_hat_DISW_3,
formatted_w_hat_DISW_4 = formatted_w_hat_DISW_4,
formatted_w_hat_AISW_1 = formatted_w_hat_AISW_1,
formatted_w_hat_AISW_2 = formatted_w_hat_AISW_2,
formatted_w_hat_AISW_3 = formatted_w_hat_AISW_3,
formatted_w_hat_AISW_4 = formatted_w_hat_AISW_4), file = formatted_w_hat_file)
}
}
v2 <- TRUE
# Plotting
extra_skip <- 30
plot_A1 <- plotting_summarized_weights(w_hat = formatted_w_hat_AISW_1$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25)
plot_A1
plotting_summarized_weights <- function (w_hat, r, models, colors, uncertain_size = 40, extra_skip = 0, y_max = NULL, ...) {
names(colors) <- models
alphas <- c(1, 2)
w_hat <- w_hat |> add_column(aa = factor(ifelse(w_hat$forecast_date <= (r[1] + uncertain_size), alphas[1], alphas[2])))
ifelse(length(unique(w_hat$aa)) == 1, rr <- 1, rr <- c(0.25, 1))
pp <- w_hat %>%
ggplot(aes(fill = as.factor(model), x = forecast_date)) +
geom_bar(aes(y = value, alpha = aa), position = "stack", stat = "identity") +
geom_vline(xintercept = as.numeric(r[1] + (uncertain_size + 1)) - 0.5, linetype = "dashed") +
geom_vline(xintercept = as.numeric(r[1] + (uncertain_size + 1)  + extra_skip) - 0.5, linetype = "dashed") +
{ if (!is.null(y_max)) geom_hline(yintercept = 1, linetype = "dashed")  } +
scale_fill_manual("Models", values = colors) +
scale_alpha_manual(values = rr, guide = "none") +
scale_x_date(limit = c((r[1] + 1), max(w_hat$forecast_date))) +
labs(x = "Forecast date", y = "Weights (Averaged over horizons and quantiles)") +
theme_bw() +
theme(legend.position = "right", text = element_text(size = 14, family = "LM Roman 10")) +
{ if (!is.null(y_max)) scale_y_continuous(breaks = seq(0, y_max, length.out = 6), limits = c(0, y_max)) } +
{ if ( is.null(y_max)) scale_y_continuous() }
pp
}
plot_A1 <- plotting_summarized_weights(w_hat = formatted_w_hat_AISW_1$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25)
plot_A1
v2 <- TRUE
# Plotting
extra_skip <- 30
if (aggregate_total) { # Aggregated
plot_D1 <- plotting_summarized_weights(w_hat = formatted_w_hat_DISW_1$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip)
plot_D2 <- plotting_summarized_weights(w_hat = formatted_w_hat_DISW_2$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip)
plot_D3 <- plotting_summarized_weights(w_hat = formatted_w_hat_DISW_3$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip)
plot_D4 <- plotting_summarized_weights(w_hat = formatted_w_hat_DISW_4$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip)
plot_A1 <- plotting_summarized_weights(w_hat = formatted_w_hat_AISW_1$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25)
plot_A2 <- plotting_summarized_weights(w_hat = formatted_w_hat_AISW_2$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25)
plot_A3 <- plotting_summarized_weights(w_hat = formatted_w_hat_AISW_3$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25)
plot_A4 <- plotting_summarized_weights(w_hat = formatted_w_hat_AISW_4$new_w_hat, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25)
} else {
if (indep_quant) { # Per quantile
plot_D1 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_DISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, sub_tt = "")
plot_D2 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_DISW_2$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, sub_tt = "")
plot_D3 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_DISW_3$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, sub_tt = "")
plot_D4 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_DISW_4$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, sub_tt = " (Averaged over horizons)")
plot_A1 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_AISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25, sub_tt = "")
plot_A2 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_AISW_2$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25, sub_tt = "")
plot_A3 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_AISW_3$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25, sub_tt = "")
plot_A4 <- plotting_quantile_weights_v2(w_hat = formatted_w_hat_AISW_4$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, extra_skip = extra_skip, y_max = 1.25, sub_tt = " (Averaged over horizons)")
} else { # Per horizon
plot_D1 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_DISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, all_same = TRUE)
plot_D2 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_DISW_2$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, all_same = TRUE)
plot_D3 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_DISW_3$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, all_same = TRUE)
plot_D4 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_DISW_4$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, all_same = FALSE)
plot_A1 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_AISW_1$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, y_max = 1.25, all_same = TRUE)
plot_A2 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_AISW_2$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, y_max = 1.25, all_same = TRUE)
plot_A3 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_AISW_3$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, y_max = 1.25, all_same = TRUE)
plot_A4 <- plotting_horizon_weights_v2(w_hat = formatted_w_hat_AISW_4$new_w_hat_total, r = rr, models = models_orig, colors = colors_orig, big_title = "", extra_skip = extra_skip, y_max = 1.25, all_same = FALSE)
}
}
dim_f <- function (all_same, ...) {
if (v2 == TRUE) { wi <- 4600; he <- 1375 } else { wi <- 3500; he <- 2500 }
if (!aggregate_total & !indep_quant) {
if (v2 == TRUE) {
if (all_same) {
wi <- 2080 # 1533
he <- 1250
} else {
wi <- 4600; he <- 3500
}
} else { stop("To be defined.") }
}
c(wi, he)
}
dim_same <- dim_f(all_same = TRUE )
dim_vary <- dim_f(all_same = FALSE)
ggsave(filename = paste("PLOTS/weights_D1.jpeg", sep = ""), plot = plot_D1, width = dim_same[1], height = dim_same[2], units = c("px"), dpi = 300, bg = "white")
ggsave(filename = paste("PLOTS/weights_D2.jpeg", sep = ""), plot = plot_D2, width = dim_same[1], height = dim_same[2], units = c("px"), dpi = 300, bg = "white")
ggsave(filename = paste("PLOTS/weights_D3.jpeg", sep = ""), plot = plot_D3, width = dim_same[1], height = dim_same[2], units = c("px"), dpi = 300, bg = "white")
ggsave(filename = paste("PLOTS/weights_D4.jpeg", sep = ""), plot = plot_D4, width = dim_vary[1], height = dim_vary[2], units = c("px"), dpi = 300, bg = "white")
ggsave(filename = paste("PLOTS/weights_A1.jpeg", sep = ""), plot = plot_A1, width = dim_same[1], height = dim_same[2], units = c("px"), dpi = 300, bg = "white")
ggsave(filename = paste("PLOTS/weights_A2.jpeg", sep = ""), plot = plot_A2, width = dim_same[1], height = dim_same[2], units = c("px"), dpi = 300, bg = "white")
ggsave(filename = paste("PLOTS/weights_A3.jpeg", sep = ""), plot = plot_A3, width = dim_same[1], height = dim_same[2], units = c("px"), dpi = 300, bg = "white")
ggsave(filename = paste("PLOTS/weights_A4.jpeg", sep = ""), plot = plot_A4, width = dim_vary[1], height = dim_vary[2], units = c("px"), dpi = 300, bg = "white")
